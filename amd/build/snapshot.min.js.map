{"version":3,"file":"snapshot.min.js","sources":["../src/snapshot.js"],"sourcesContent":["define(['jquery', 'core/str', 'core/notification'], function ($, str, notification) {\n\n    return {\n        init: function (uniqid) {\n            var video = document.getElementById(uniqid + '_video');\n            var canvas = document.getElementById(uniqid + '_canvas');\n            var snapBtn = document.getElementById(uniqid + '_snap_btn');\n            var retakeBtn = document.getElementById(uniqid + '_retake_btn');\n            var hiddenInput = document.getElementById(uniqid + '_hidden');\n            var stream = null;\n\n            if (!video || !canvas || !snapBtn || !retakeBtn || !hiddenInput) {\n                console.warn('Snapshot elements not found for id: ' + uniqid);\n                return;\n            }\n\n            navigator.mediaDevices.getUserMedia({ video: true })\n                .then(function (s) {\n                    stream = s;\n                    video.srcObject = stream;\n                    video.onloadedmetadata = function (e) {\n                        video.play().catch(function (err) {\n                            console.error(\"Error playing video: \", err);\n                        });\n                    };\n                })\n                .catch(function (err) {\n                    console.log(\"An error occurred: \" + err);\n                    str.get_string('cameraaccesserror', 'block_profilepic').then(function (s) {\n                        notification.alert('Error', s + ' ' + err.message);\n                    }).catch(function () {\n                        alert(\"Could not access webcam: \" + err.message);\n                    });\n                });\n\n            snapBtn.addEventListener(\"click\", function () {\n                var context = canvas.getContext(\"2d\");\n                context.drawImage(video, 0, 0, 320, 240);\n                var dataURL = canvas.toDataURL(\"image/png\");\n                hiddenInput.value = dataURL;\n\n                video.style.display = \"none\";\n                canvas.style.display = \"inline-block\";\n                snapBtn.style.display = \"none\";\n                retakeBtn.style.display = \"inline-block\";\n            });\n\n            retakeBtn.addEventListener(\"click\", function () {\n                video.style.display = \"inline-block\";\n                canvas.style.display = \"none\";\n                snapBtn.style.display = \"inline-block\";\n                retakeBtn.style.display = \"none\";\n                hiddenInput.value = \"\";\n            });\n        }\n    };\n});\n"],"names":["define","$","str","notification","init","uniqid","video","document","getElementById","canvas","snapBtn","retakeBtn","hiddenInput","stream","navigator","mediaDevices","getUserMedia","then","s","srcObject","onloadedmetadata","e","play","catch","err","console","error","log","get_string","alert","message","addEventListener","getContext","drawImage","dataURL","toDataURL","value","style","display","warn"],"mappings":"AAAAA,mCAAO,CAAC,SAAU,WAAY,sBAAsB,SAAUC,EAAGC,IAAKC,oBAE3D,CACHC,KAAM,SAAUC,YACRC,MAAQC,SAASC,eAAeH,OAAS,UACzCI,OAASF,SAASC,eAAeH,OAAS,WAC1CK,QAAUH,SAASC,eAAeH,OAAS,aAC3CM,UAAYJ,SAASC,eAAeH,OAAS,eAC7CO,YAAcL,SAASC,eAAeH,OAAS,WAC/CQ,OAAS,KAERP,OAAUG,QAAWC,SAAYC,WAAcC,aAKpDE,UAAUC,aAAaC,aAAa,CAAEV,OAAO,IACxCW,MAAK,SAAUC,GACZL,OAASK,EACTZ,MAAMa,UAAYN,OAClBP,MAAMc,iBAAmB,SAAUC,GAC/Bf,MAAMgB,OAAOC,OAAM,SAAUC,KACzBC,QAAQC,MAAM,wBAAyBF,YAIlDD,OAAM,SAAUC,KACbC,QAAQE,IAAI,sBAAwBH,KACpCtB,IAAI0B,WAAW,oBAAqB,oBAAoBX,MAAK,SAAUC,GACnEf,aAAa0B,MAAM,QAASX,EAAI,IAAMM,IAAIM,YAC3CP,OAAM,WACLM,MAAM,4BAA8BL,IAAIM,eAIpDpB,QAAQqB,iBAAiB,SAAS,WAChBtB,OAAOuB,WAAW,MACxBC,UAAU3B,MAAO,EAAG,EAAG,IAAK,SAChC4B,QAAUzB,OAAO0B,UAAU,aAC/BvB,YAAYwB,MAAQF,QAEpB5B,MAAM+B,MAAMC,QAAU,OACtB7B,OAAO4B,MAAMC,QAAU,eACvB5B,QAAQ2B,MAAMC,QAAU,OACxB3B,UAAU0B,MAAMC,QAAU,kBAG9B3B,UAAUoB,iBAAiB,SAAS,WAChCzB,MAAM+B,MAAMC,QAAU,eACtB7B,OAAO4B,MAAMC,QAAU,OACvB5B,QAAQ2B,MAAMC,QAAU,eACxB3B,UAAU0B,MAAMC,QAAU,OAC1B1B,YAAYwB,MAAQ,OAxCpBX,QAAQc,KAAK,uCAAyClC"}